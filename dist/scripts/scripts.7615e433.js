"use strict";angular.module("tictactoeApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/game.html",controller:"GameCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("tictactoeApp").controller("GameCtrl",["$scope","GameLogic","AiLogic","$timeout",function(a,b,c,d){a.board=null,a.announcement=null,a.opponent="AI",a.goesFirst="Me",a.opponentMark="x",a.playerMark="o",a.newGame=function(){if(a.announcement=null,a.gameEnded=!1,a.board=b.newBoard(),a.playerMark="x"===a.opponentMark?"o":"x","Them"===a.goesFirst&&"human"===a.opponent){var d=a.playerMark;a.playerMark=a.opponentMark,a.opponentMark=d}if("AI"===a.opponent&&(c.me=a.opponentMark,c.them=a.playerMark),"Them"===a.goesFirst&&"AI"===a.opponent){var e=c.decideMove(a.board);a.aiMove(e)}},a.gameEnded=!1,a.gameEnd=function(b){b?(a.gameEnded=!0,a.announcement=b+" wins!"):(a.gameEnded=!0,a.announcement="Nobody wins!"),d(function(){a.board=null},3e3)},a.aiMove=function(b){var c=b.row,d=b.column;a.board[c][d].space=a.opponentMark},a.userMove=function(d){var e,f=d.row,g=d.column,h=a.board[f][g].space;if(""===h&&!a.gameEnded)if(a.board[f][g].space=a.playerMark,e=b.won(a.board))a.gameEnd(e);else if(b.draw(a.board))a.gameEnd();else if("AI"===a.opponent){var i=c.decideMove(a.board);a.aiMove(i),e=b.won(a.board),e?a.gameEnd(e):b.draw(a.board)&&a.gameEnd()}else{var j=a.playerMark;a.playerMark=a.opponentMark,a.opponentMark=j}},a.isLast=function(a){return a?"last":null}}]),angular.module("tictactoeApp").factory("GameLogic",function(){var a={};return a.newBoard=function(){return[[{position:{row:0,column:0},space:""},{position:{row:0,column:1},space:""},{position:{row:0,column:2},space:""}],[{position:{row:1,column:0},space:""},{position:{row:1,column:1},space:""},{position:{row:1,column:2},space:""}],[{position:{row:2,column:0},space:""},{position:{row:2,column:1},space:""},{position:{row:2,column:2},space:""}]]},a.allWins=function(){return[[{row:0,column:0},{row:0,column:1},{row:0,column:2}],[{row:1,column:0},{row:1,column:1},{row:1,column:2}],[{row:2,column:0},{row:2,column:1},{row:2,column:2}],[{row:0,column:0},{row:1,column:0},{row:2,column:0}],[{row:0,column:1},{row:1,column:1},{row:2,column:1}],[{row:0,column:2},{row:1,column:2},{row:2,column:2}],[{row:0,column:0},{row:1,column:1},{row:2,column:2}],[{row:0,column:2},{row:1,column:1},{row:2,column:0}]]},a.won=function(a){for(var b=this.allWins(),c=0;c<b.length;c++){var d=b[c],e=this.getCells(a,d);if(this.threeInRow(e))return e[0]}return!1},a.getCells=function(a,b){return b.map(function(b){return a[b.row][b.column].space})},a.draw=function(a){for(var b,c,d,e=0;e<a.length;e++){b=a[e];for(var f=0;f<b.length;f++)if(c=b[f],d=""===c.space)return!1}return!0},a.threeInRow=function(a){var b=a[0],c=a[1],d=a[2];return b===c&&c===d&&""!==b},a}),angular.module("tictactoeApp").factory("AiLogic",function(){var a={};return a.them="x",a.me="o",a.formatMoveData=function(a){return[{row:0,column:0},{row:0,column:1},{row:0,column:2},{row:1,column:0},{row:1,column:1},{row:1,column:2},{row:2,column:0},{row:2,column:1},{row:2,column:2}][a]},a.flattenBoardData=function(a){for(var b=[],c=0;c<a.length;c++)for(var d=a[c],e=0;e<d.length;e++){var f=d[e];b.push(f.space)}return b},a.decideMove=function(a){for(var b=this.flattenBoardData(a),c=-100,d=null,e=0;e<b.length;e++){var f=b[e];if(""===f){var g=angular.copy(b);g[e]=this.me;var h=this.imaginaryMoveThem(g);h>c&&(c=h,d=e)}}return this.formatMoveData(d)},a.imaginaryMoveThem=function(a){var b=this.drawn(a),c=this.won(a,this.me),d=this.won(a,this.them);if(c)return 1;if(d)return-1;if(b)return 0;for(var e=100,f=0;f<a.length;f++){var g=a[f];if(""===g){var h=angular.copy(a);h[f]=this.them;var i=this.imaginaryMoveMe(h);if(e>i&&(e=i),-1===i)break}}return e},a.imaginaryMoveMe=function(a){var b=this.drawn(a),c=this.won(a,this.me),d=this.won(a,this.them);if(c)return 1;if(d)return-1;if(b)return 0;for(var e=-100,f=0;f<a.length;f++){var g=a[f];if(""===g){var h=angular.copy(a);h[f]=this.me;var i=this.imaginaryMoveThem(h);if(i>e&&(e=i),1===i)break}}return e},a.drawn=function(a){return a.every(function(a){return""!==a})},a.won=function(a,b){return a[0]===b&&a[1]===b&&a[2]===b||a[3]===b&&a[4]===b&&a[5]===b||a[6]===b&&a[7]===b&&a[8]===b||a[0]===b&&a[3]===b&&a[6]===b||a[1]===b&&a[4]===b&&a[7]===b||a[2]===b&&a[5]===b&&a[8]===b||a[0]===b&&a[4]===b&&a[8]===b||a[2]===b&&a[4]===b&&a[6]===b},a});